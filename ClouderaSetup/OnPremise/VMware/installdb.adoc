= PostgreSQL Installation and Configuration for Cloudera Manager

== Table of Contents

* <<introduction,Introduction>>
* <<prerequisites,Prerequisites>>
* <<installation,PostgreSQL Installation>>
* <<configuration,Configuration>>
* <<ssl_setup,SSL Setup>>
* <<user_db_creation,User and Database Creation>>
* <<verification,Verification>>
* <<troubleshooting,Troubleshooting>>
* <<conclusion,Conclusion>>

== [[introduction]] Introduction

This document provides a step-by-step guide to installing and configuring PostgreSQL for use with Cloudera Manager. The setup includes SSL configuration and database provisioning for Cloudera services.

[.text-center]
*Navigation:*
<<prerequisites,Next: Prerequisites>> | <<table_of_contents,Back to Table of Contents>>

== [[prerequisites]] Prerequisites

* Ensure the system has a supported version of PostgreSQL (>=12).
* The system should have internet access to download PostgreSQL packages.
* Root or sudo access is required.

[.text-center]
*Navigation:*
<<installation,Next: PostgreSQL Installation>> | <<table_of_contents,Back to Table of Contents>>

== [[installation]] PostgreSQL Installation

```sh
sudo yum install -y postgresql-server postgresql-contrib
sudo postgresql-setup initdb
sudo systemctl enable --now postgresql
```

[.text-center]
*Navigation:*
<<configuration,Next: Configuration>> | <<table_of_contents,Back to Table of Contents>>

== [[configuration]] Configuration

Modify `postgresql.conf` and `pg_hba.conf` for secure access.

```sh
sudo vi /var/lib/pgsql/data/postgresql.conf
```

Set `listen_addresses = '*'` and adjust connection settings in `pg_hba.conf`.

Restart PostgreSQL:
```sh
sudo systemctl restart postgresql
```

[.text-center]
*Navigation:*
<<ssl_setup,Next: SSL Setup>> | <<table_of_contents,Back to Table of Contents>>

== [[ssl_setup]] SSL Setup

Generate and configure SSL certificates:
```sh
openssl req -new -x509 -days 365 -nodes -out server.crt -keyout server.key
sudo mv server.crt server.key /var/lib/pgsql/data/
chmod 600 /var/lib/pgsql/data/server.*
```

Enable SSL in `postgresql.conf`:
```sh
ssl = on
ssl_cert_file = '/var/lib/pgsql/data/server.crt'
ssl_key_file = '/var/lib/pgsql/data/server.key'
```

Restart PostgreSQL:
```sh
sudo systemctl restart postgresql
```

[.text-center]
*Navigation:*
<<user_db_creation,Next: User and Database Creation>> | <<table_of_contents,Back to Table of Contents>>

== [[user_db_creation]] User and Database Creation

Create users and databases:
```sh
sudo -i -u postgres psql
CREATE USER cm WITH ENCRYPTED PASSWORD 'password';
CREATE DATABASE cm OWNER cm;
```

[.text-center]
*Navigation:*
<<verification,Next: Verification>> | <<table_of_contents,Back to Table of Contents>>

== [[verification]] Verification

Check PostgreSQL service status:
```sh
sudo systemctl status postgresql
```

Verify database connection:
```sh
psql -U cm -d cm -h localhost -W
```

[.text-center]
*Navigation:*
<<troubleshooting,Next: Troubleshooting>> | <<table_of_contents,Back to Table of Contents>>

== [[troubleshooting]] Troubleshooting

* Ensure PostgreSQL is running: `systemctl status postgresql`
* Check logs for errors: `journalctl -u postgresql --no-pager | tail -20`
* Verify firewall settings if connections are refused.

[.text-center]
*Navigation:*
<<conclusion,Next: Conclusion>> | <<table_of_contents,Back to Table of Contents>>

== [[conclusion]] Conclusion

This guide covered PostgreSQL installation, configuration, SSL setup, and database provisioning for Cloudera Manager.

[.text-center]
*Navigation:*
<<table_of_contents,Back to Table of Contents>>

