= Install Cloudera Manager Server (CM-UI)

Cloudera Manager, an end-to-end management application, is used to install and configure CDP Private Cloud Base. During CDP installation, Cloudera Manager's wizard helps install Hadoop services and other roles/services on all nodes using the following procedure:

- Discovery of the cluster nodes
- Configure the Cloudera parcel or package repositories
- Install Hadoop, Cloudera Manager Agent (CMA), and Impala on all cluster nodes
- Install Oracle JDK or OpenJDK if it is not already installed across all nodes
- Assign various services to nodes
- Start Hadoop services

== Install Cloudera Manager Server Packages
Run the following command to install the necessary Cloudera Manager Server packages:

[source,shell]
----
[root@cldr-mngr data]# dnf install -y cloudera-manager-agent cloudera-manager-daemons cloudera-manager-server
----

[NOTE]
====
*Recommendation:* Always install agents via CM-UI only. Manual installation generates agent config as localhost, leading to heartbeat errors. If a heartbeat error occurs, run the following command to update the agent config before starting `scm-server`:

[source,shell]
----
[root@cldr-mngr data]# sed -i 's/server_host=localhost/server_host=cldr-mngr.cldrsetup.local/g' /etc/cloudera-scm-agent/config.ini
----
====

Enable TLS 1.2 on Cloudera Manager Server: link:https://docs.cloudera.com/cloudera-manager/7.11.3/installation/topics/cdpdc-enable-tls-12-cm-server.html[Enable TLS 1.2]

== Import the PostgreSQL Root Certificate

If the Database host and Cloudera Manager Server host are on the same machine, follow these steps to import the PostgreSQL root certificate:

[source,shell]
----
[root@cldr-mngr data]# mkdir -p /var/lib/cloudera-scm-server/.postgresql
[root@cldr-mngr data]# chmod 755 /var/lib/cloudera-scm-server/.postgresql
[root@cldr-mngr data]# cd /var/lib/cloudera-scm-server/.postgresql
[root@cldr-mngr data]# cp /var/lib/pgsql/14/data/root.crt root.crt
[root@cldr-mngr data]# chown cloudera-scm: root.crt
[root@cldr-mngr data]# ls -lt
----

Include this root certificate path in the JDBC URL:

[source]
----
jdbc:postgresql://cldr-mngr.cldrsetup.local:5432/scm?ssl=true&sslmode=verify-ca&sslrootcert=/var/lib/cloudera-scm-server/.postgresql/root.crt
----

== Configure Ranger SSL

[source,shell]
----
[root@cldr-mngr data]# cp /usr/share/java/postgresql-connector-java.jar /opt/cloudera/cm/lib/postgresql-connector.jar
[root@cldr-mngr data]# unlink /opt/cloudera/cm/lib/postgresql-42.*.jar
[root@cldr-mngr data]# chmod 755 /var/lib/cloudera-scm-server/
[root@cldr-mngr data]# ls -ltr /var/lib/cloudera-scm-server/.postgresql/*.crt
----

== Configure the Cloudera Manager Database
Run the `scm_prepare_database.sh` script to configure PostgreSQL with TLS 1.2:

[source,shell]
----
[root@cldr-mngr ~]# sudo /opt/cloudera/cm/schema/scm_prepare_database.sh -hcldr-mngr.cldrsetup.local \
--jdbc-url "jdbc:postgresql://cldr-mngr.cldrsetup.local:5432/scm?ssl=true&sslmode=verify-ca&sslrootcert=/var/lib/cloudera-scm-server/.postgresql/root.crt" \
postgresql scm scm scm --ssl
----

Verify the generated `db.properties` file:

[source,shell]
----
[root@cldr-mngr ~]# cat /etc/cloudera-scm-server/db.properties
----

== Start Cloudera Manager Server

[source,shell]
----
[root@cldr-mngr ~]# systemctl start cloudera-scm-server cloudera-scm-agent
[root@cldr-mngr ~]# systemctl enable cloudera-scm-server cloudera-scm-agent
[root@cldr-mngr ~]# systemctl status cloudera-scm-server cloudera-scm-agent -l
----

Check Cloudera Manager logs:

[source,shell]
----
[root@cldr-mngr ~]# sudo tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log
----

Once the Cloudera Manager installation is complete, open the WebUI at:

[source]
----
http://<cldr-mngr_ip_addr>:7180/
----

Login using the default credentials:

- **Username:** admin
- **Password:** admin

After logging in, override the Java path in CM-UI:

[source,shell]
----
/usr/lib/jvm/java-17-openjdk-17.0.13.0.11-4.el9.x86_64
----

== Activate Cloudera Data Platform License

1. Upload the CDP license (`.txt` or `.zip` file)
2. Click **Continue** to activate the license

== Enable AutoTLS for CM
Before enabling AutoTLS, verify that Cloudera Manager Agent is installed and running:

[source,shell]
----
[root@cldr-mngr ~]# tail -f /var/log/cloudera-scm-agent/cloudera-scm-agent.log
[root@cldr-mngr ~]# systemctl status cloudera-scm-agent -l
----

