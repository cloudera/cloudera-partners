= Participant AMPs Setup
:description: Participant AMPs Setup Instuctions
:toc: left
:toclevels: 2
:sectnums:
:source-highlighter: rouge
:icons: font
:imagesdir: ./images
:hide-uri-scheme:
:homepage: https://github.com/cloudera/cloudera-partners

== Overview
Here we will use a browser automation plugin called Selenium to go through the tedious process of launching an AMP for each participant in the workshop. Alternatively, this can be done manually, as a fall back when the automation is not working. 

These steps need to be done on your machine, rather than inside of a docker container. 

== Setup automation and test 
This step requires a download of a Chrome plugin to be able to automate the task of logging into CDP, going to your ML workspace, and lauching an AMP with the right environment variable parameters. 

Download the right version for your machine from here: https://googlechromelabs.github.io/chrome-for-testing/. Time to time the specific driver needs to be updated, as you update your browser. 

You can find your chrome version by going into `Settings -> About Chrome` of your browser.

> **Note:** The ChromeDriver version must match your current Chrome browser version. If you don't see your version listed for your platform (Linux, Mac, or Windows) on the website, try replacing the version in the download link with your browser's version number.

image::../../img/Chromedriver.png[Chromedriver.png]

A Mac may prevent you from running the executable chromedriver, so you'll need to add it in your Privacy & Security settings to trusted apps. 

Next, perform the following steps to set everything up and run a simple test:

.. Clone this repo `git clone https://github.com/Avanish268/ai-agents-hol-setup.git/[https://github.com/Avanish268/ai-agents-hol-setup.git]`
.. Navigate to amplifier folder ```cd ai-agents-hol-setup/4_participant_amps/amplifier```
.. Place **chromedriver** executable you've downloaded into this directory
.. Create and activate a virtualenvironment ```python3 -m venv .; source ./bin/activate``` (Assuming you have Python3 installed locally)
.. Install selenium package ```pip3 install selenium``` and install pandas ```pip3 install pandas```
.. Run the test script ```python3 selenium-test.py```. Note: This test may fail if the Cloudera website has been updated.
.. You should see a new browser window open, automatic navigation to Cloudera docs, followed by navigation to Cloudera AI docs home page. **DO NOT** interact with the browser during the test.
.. Once the test finishes, you should see ```ALL TEST PASSED!``` in the console. You are ready to move on to bulk AMPs creation.

== Add AMP catalog to your workbench
Before you can create AMPs for the participants, you need to upload the AMP catalog to your Cloudera AI workbench.

To add the AMP catalog follow these steps:


* Go to your Cloudera AI workbench
* Click on the "Site Administration" tab in the left sidebar
* CLick on the `AMPs` tab
* Add a new source by `Catalog File URL`
* Enter the URL of the AMP catalog file: https://raw.githubusercontent.com/Avanish268/ai-agents-hol-cai/refs/heads/release/v1_3/catalog-entry.yaml[https://raw.githubusercontent.com/Avanish268/ai-agents-hol-cai/refs/heads/release/v1_3/catalog-entry.yaml]
* Click on the "Add Source" button to upload the catalog
* Verify that the catalog is successfully added by checking the list of available AMPs in the workbench. You should see the AMP named `Hands on Lab with RAG Agents` in the list.

image::../../img/Add_Amp.png[AMP-catalog.png]

== Disable "Reset Password on First Login" in Keycloak
To ensure Selenium automation works smoothly, disable the `reset_password_on_first_login` option in Keycloak for all participants. This prevents the automation script from being interrupted by password reset prompts.


* Log in to Keycloak as an admin: https://partnerday.clouderapartners.click[https://partnerday.clouderapartners.click]
* Navigate to the `Authentication` section in the left sidebar
* Click on the `Required Actions` tab
* Toggle off the `Update Password` option

image::../../img/Disable_Reset_Password.png[Disable Reset Password on First Login]

== Run Bulk AMP creation
In this step you will run an automation script that launches an AMP for each paricipant. First, a few configuration steps:

.. Make sure all of the participant credentials are listed properly in ```./amplifier/participants.csv```. These are the Keycloak credentials for all the users.
.. Open up ```./amplifier/amplifier.py``` and edit three global variables at the top:
    * **SSO_URL** - set it to the URL you use to get to the SSO interface of your CDP tenant (e.g. sandbox or marketing tenant)
    * **AMP_NAME** - set it to the name of the AMP that you've given the lab after uploading the catalog to the workbench
    * **WORKSPACE_URL** - set it to URL of your workspace. The file currently has a sample from a previous workspace for reference
.. Save the ```.py``` file
.. Get yourself a coffee, the next step will take a while. For every 8 AMPs expect to wait about 30 mins. For a 50 person workshop, the AMP creation will take approximately 2 hours.
.. While in the ```./amplifier``` directory, in the command line execute ```python3 amplifier.py```.

Check the logs (stdout) periodically to make sure things are progressing. You may need to baby sit this automation since any latency in loading the Cloudera AI website may break the automation. In that case, make sure to verify which users' AMPs were successful and do not re-create them. Remove the users from the CSV file.

== Verify Installed Dependencies

Go into each participant's AMP in Cloudera AI and ensure that the dependencies are successfully installed. While rare, there are intermittent issues where the install fails. In that case, you can just re-deploy the AMP for the affected user.
